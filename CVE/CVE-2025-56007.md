## CVE-2025-56007

#### Some boring notes on discovery

One evening I was examining my router's admin panel for web vulnerabilities.
Specifically, the router web panel has a small attack surface: the `/rci` endpoint, which handles API commands after authentication, and the authentication endpoint `/auth` itself.

I decided to inspect the `/auth` endpoint and quickly found a hidden parameter, `url`, using Param Miner. If you are already authorized, the router redirects you to the given `url` by adding a header `Location: <given url>` to the response. Sounds quite harmless, right?

Well, yes, but actually no. It is already an open redirect, but it is useless without additional primitives that I couldn't find.

Although I wasn't able to use open redirect, I discovered that the server wasn't filtering the passed URL in any way. Specifically, it turned out to be a CRLF injection vulnerability: I could substitute `%0d%0a (\r\n)` (or just `%0a (\n)` is enough) into the parameter, thereby inserting any headers and body into the response:

URL: `/auth?url=https://example.com/%0aX:+Y%0a`

Response:

```
HTTP/2 303 See Other
...
Location: https://example.com/
X: Y
<other headers>

...
```

To be honest, encountering this in 2025 was unexpected - but I can explain this by the fact that the parameter was not used and remained from ancient times (at least I think so).

#### Exploitation

Okay, we have control over the response body, so we can just return arbitrary HTML --> get XSS --> get router takeover. Yes?

Yes, but not so easy.

First thing I want to mention is that we should somehow prevent the redirect, or our payload simply won't fire in modern browsers. To do this, fortunately, we could just leave the location header empty by starting our payload with `%0a`: `url=%0a...`.

Secondly, we should specify the correct content-type. Happily, because of the redirect server doesn't add one, so the can just define it.

The final payload I managed to obtain is:

```
ADMIN_URL/auth?url=%0aContent-Type:text/html%0a%0a<script>alert(document.cookie)</script>
```

Here `ADMIN_URL` may be an IP address (e.g., `192.168.0.1`) or a Keenetic DNS name (`xxx.keenetic.name`).

By managing the victim to open this page, we will get XSS, and it is not hard to change admin password with it or do anything else. Because this writeup concerns real software and is intended for educational purposes only, I will not publish the full exploit here.

#### Some other notes

What have we learned from this case? For myself, I can highlight that researching uncharted targets, such as router admin panels, can yield interesting results (this is not the primary function of a router, and therefore some classic security measures inherent to web servers can be skipped here).

Also, I could try another way of exploitation - for example, I may try to poison the response queue with my malicious response - but I simply decided not to dive into it because usual payloads doesn't work, and I don't have enough time to investigate it.
